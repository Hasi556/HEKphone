<?php

/**
 * Residents
 *
 * This class has been auto-generated by the Doctrine ORM Framework
 *
 * @package    hekphone
 * @subpackage model
 * @author     Your name here
 * @version    SVN: $Id: Builder.php 7490 2010-03-29 19:53:27Z jwage $
 */
class Residents extends BaseResidents
{
     /**
     * Writes the residents password md5-encrypted to the database
     *
     * @param string $password
     */
    public function setPassword($password)
    {
      // don't update to empty password
      if ($password == '')
      {
        return $this;
      }
      else
      {
        return $this->_set('password', md5($password));
      }
    }

    /**
     * Sets a residents voicemail-settings. Modifies the asterisk_voicemail and
     * asterisk_extensions database table.
     *
     * @param boolean $active
     * @param integer $seconds
     * @param boolean $mailOnNewMessage
     * @param boolean $attachMessage
     * @param boolean $mailOnMissedCall
     */
    public function setVoicemailSettings($active, $seconds, $mailOnNewMessage, $attachMessage, $mailOnMissedCall)
    {
      $this->set('vm_active', $active);
      $this->set('vm_seconds', $seconds);
      $this->set('mail_on_missed_call', $mailOnMissedCall);
      // This updates the users extension
      if( ! Doctrine_Core::getTable('AsteriskExtensions')
            ->updateResidentsExtension($this)){

          return false;
      }

      return true;
    }

    public function getVoicemailSettings()
    {
      //TODO: Implement this!
    }

    public function sendLockUnlockEmail()
    {
      if($this->unlocked)
      {
        $this->sendUnlockEmail();
      }
      else
      {
        $this->sendLockEmail();
      }
    }

    public function sendUnlockEmail()
    {
      $mailer = sfContext::getInstance()->getMailer();
      // TODO: load partial and send email
    }

    public function sendLockEmail()
    {
      $mailer = sfContext::getInstance()->getMailer();
      // TODO: load partial and send Email
    }
}

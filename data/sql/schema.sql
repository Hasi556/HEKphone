CREATE TABLE asterisk_cdr (id BIGSERIAL, calldate TIMESTAMP DEFAULT 'now()' NOT NULL, clid TEXT NOT NULL, src TEXT NOT NULL, dst TEXT NOT NULL, dcontext TEXT NOT NULL, channel TEXT NOT NULL, dstchannel TEXT NOT NULL, lastapp TEXT NOT NULL, lastdata TEXT NOT NULL, duration BIGINT DEFAULT 0 NOT NULL, billsec BIGINT DEFAULT 0 NOT NULL, disposition TEXT NOT NULL, amaflags BIGINT DEFAULT 0 NOT NULL, accountcode TEXT NOT NULL, uniqueid TEXT NOT NULL, userfield TEXT NOT NULL, billed BOOLEAN DEFAULT 'false' NOT NULL, PRIMARY KEY(id));
CREATE TABLE asterisk_extensions (id INT, context TEXT NOT NULL, exten TEXT NOT NULL, priority SMALLINT DEFAULT 0 NOT NULL, app TEXT NOT NULL, appdata TEXT, PRIMARY KEY(id));
CREATE TABLE asterisk_sip (id INT, name TEXT NOT NULL, accountcode TEXT, callerid TEXT, canreinvite TEXT DEFAULT 'yes', context TEXT NOT NULL, host TEXT NOT NULL, port INT, mailbox TEXT, md5secret TEXT, nat TEXT DEFAULT 'no' NOT NULL, permit TEXT, deny TEXT, mask TEXT, qualify TEXT, secret TEXT, type TEXT DEFAULT 'friend' NOT NULL, username TEXT NOT NULL, defaultuser TEXT, useragent TEXT, fromuser TEXT DEFAULT 'NULL', fromdomain TEXT DEFAULT 'NULL', disallow TEXT DEFAULT 'all', allow TEXT DEFAULT 'ulaw;alaw', ipaddr TEXT, mac TEXT, fullcontact TEXT DEFAULT NULL, regexten TEXT DEFAULT NULL, regserver TEXT DEFAULT NULL, regseconds BIGINT DEFAULT 0, lastms BIGINT DEFAULT 0, PRIMARY KEY(id));
CREATE TABLE asterisk_voicemail (id INT NOT NULL, customer_id BIGINT DEFAULT 0 NOT NULL, context TEXT NOT NULL, mailbox BIGINT DEFAULT 0 NOT NULL, password TEXT DEFAULT '0' NOT NULL, fullname TEXT NOT NULL, email TEXT NOT NULL, pager TEXT NOT NULL, stamp TIMESTAMP NOT NULL);
CREATE TABLE banks (bank_number VARCHAR(8) UNIQUE, name VARCHAR(80) NOT NULL, zip CHAR(5), locality VARCHAR(80), PRIMARY KEY(bank_number));
CREATE TABLE bills (id BIGINT, resident BIGINT NOT NULL, date DATE NOT NULL, amount NUMERIC(18,2) NOT NULL, debit_failed BOOLEAN DEFAULT 'false' NOT NULL, PRIMARY KEY(id));
CREATE TABLE calls (id BIGINT, resident BIGINT NOT NULL, extension VARCHAR(10) NOT NULL, date TIMESTAMP DEFAULT 'now()', duration VARCHAR(6) NOT NULL, destination VARCHAR(50) NOT NULL, charges NUMERIC(18,2) NOT NULL, rate BIGINT NOT NULL, bill BIGINT DEFAULT 0, PRIMARY KEY(id));
CREATE TABLE comments (id BIGSERIAL, resident BIGINT NOT NULL, stamp TIMESTAMP DEFAULT 'now()' NOT NULL, comment VARCHAR(1000) NOT NULL, PRIMARY KEY(id));
CREATE TABLE phones (id BIGINT, name TEXT NOT NULL UNIQUE, accountcode TEXT, callerid TEXT, canreinvite TEXT DEFAULT 'yes', host TEXT NOT NULL, port BIGINT, mailbox TEXT, md5secret TEXT, nat TEXT DEFAULT 'no' NOT NULL, permit TEXT, deny TEXT, mask TEXT, qualify TEXT, secret TEXT, type TEXT DEFAULT 'friend' NOT NULL, username TEXT NOT NULL, defaultuser TEXT, useragent TEXT, fromuser TEXT DEFAULT NULL, fromdomain TEXT DEFAULT NULL, disallow TEXT DEFAULT 'all', allow TEXT DEFAULT 'ulaw;alaw', ipaddr TEXT, mac TEXT UNIQUE, fullcontact TEXT DEFAULT NULL, regexten TEXT DEFAULT NULL, regserver TEXT DEFAULT NULL, regseconds BIGINT DEFAULT 0, lastms BIGINT DEFAULT 0, PRIMARY KEY(id));
CREATE TABLE prefixes (id BIGINT, prefix VARCHAR(20) NOT NULL, name VARCHAR(80) NOT NULL, region BIGINT NOT NULL, PRIMARY KEY(id));
CREATE TABLE providers (id SMALLINT, name VARCHAR(20) NOT NULL, PRIMARY KEY(id));
CREATE TABLE rates (id BIGINT, provider SMALLINT NOT NULL, primary_time_begin TIME NOT NULL, primary_time_rate NUMERIC(18,2) NOT NULL, secondary_time_begin TIME, secondary_time_rate NUMERIC(18,2), weekend BOOLEAN DEFAULT 'true' NOT NULL, week BOOLEAN DEFAULT 'true' NOT NULL, pulsing VARCHAR(255) NOT NULL, name VARCHAR(80) NOT NULL, PRIMARY KEY(id));
CREATE TABLE rates_regions (id BIGINT, rate BIGINT NOT NULL, region BIGINT, PRIMARY KEY(id));
CREATE TABLE regions (id BIGINT, name VARCHAR(80) NOT NULL UNIQUE, PRIMARY KEY(id));
CREATE TABLE residents (id BIGINT, last_name VARCHAR(50) NOT NULL, first_name VARCHAR(50) NOT NULL, email VARCHAR(255), move_in DATE NOT NULL, move_out DATE, bill_limit INT DEFAULT 75 NOT NULL, room INT, warning1 BOOLEAN DEFAULT 'false', warning2 BOOLEAN DEFAULT 'false', unlocked BOOLEAN DEFAULT 'false', shortened_itemized_bill BOOLEAN DEFAULT 'true', account_number VARCHAR(10), bank_number VARCHAR(8), password VARCHAR(255), hekphone BOOLEAN DEFAULT 'false', culture VARCHAR(5) DEFAULT 'de_DE', PRIMARY KEY(id));
CREATE TABLE rooms (id INT, room_no INT, comment TEXT, phone INT, PRIMARY KEY(id));
CREATE SEQUENCE asterisk_extensions_id_seq INCREMENT 1 START 1;
CREATE SEQUENCE asterisk_sip_id_seq INCREMENT 1 START 1;
CREATE SEQUENCE bills_id_seq INCREMENT 1 START 1;
CREATE SEQUENCE calls_id_seq INCREMENT 1 START 1;
CREATE SEQUENCE phone_id_seq INCREMENT 1 START 1;
CREATE SEQUENCE prefixes_id_seq INCREMENT 1 START 1;
CREATE SEQUENCE rates_regions_id_seq INCREMENT 1 START 1;
CREATE SEQUENCE rooms_id_seq INCREMENT 1 START 1;
ALTER TABLE bills ADD CONSTRAINT bills_resident_residents_id FOREIGN KEY (resident) REFERENCES residents(id) NOT DEFERRABLE INITIALLY IMMEDIATE;
ALTER TABLE calls ADD CONSTRAINT calls_resident_residents_id FOREIGN KEY (resident) REFERENCES residents(id) NOT DEFERRABLE INITIALLY IMMEDIATE;
ALTER TABLE comments ADD CONSTRAINT comments_resident_residents_id FOREIGN KEY (resident) REFERENCES residents(id) NOT DEFERRABLE INITIALLY IMMEDIATE;
ALTER TABLE prefixes ADD CONSTRAINT prefixes_region_regions_id FOREIGN KEY (region) REFERENCES regions(id) NOT DEFERRABLE INITIALLY IMMEDIATE;
ALTER TABLE rates ADD CONSTRAINT rates_provider_providers_id FOREIGN KEY (provider) REFERENCES providers(id) NOT DEFERRABLE INITIALLY IMMEDIATE;
ALTER TABLE rates_regions ADD CONSTRAINT rates_regions_rate_rates_id FOREIGN KEY (rate) REFERENCES rates(id) NOT DEFERRABLE INITIALLY IMMEDIATE;
ALTER TABLE residents ADD CONSTRAINT residents_room_rooms_id FOREIGN KEY (room) REFERENCES rooms(id) NOT DEFERRABLE INITIALLY IMMEDIATE;
ALTER TABLE residents ADD CONSTRAINT residents_bank_number_banks_bank_number FOREIGN KEY (bank_number) REFERENCES banks(bank_number) NOT DEFERRABLE INITIALLY IMMEDIATE;
ALTER TABLE rooms ADD CONSTRAINT rooms_phone_phones_id FOREIGN KEY (phone) REFERENCES phones(id) NOT DEFERRABLE INITIALLY IMMEDIATE;
CREATE TABLE letztezimmerbelegung (vorname TEXT, nachname TEXT, nutzerid BIGINT, zimmernummer TEXT, einzug DATE, auszug DATE, PRIMARY KEY(nutzerid));

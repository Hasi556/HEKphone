CREATE TABLE asterisk_cdr (id BIGSERIAL, calldate TIMESTAMP DEFAULT 'now()' NOT NULL, clid TEXT NOT NULL, src TEXT NOT NULL, dst TEXT NOT NULL, dcontext TEXT NOT NULL, channel TEXT NOT NULL, dstchannel TEXT NOT NULL, lastapp TEXT NOT NULL, lastdata TEXT NOT NULL, duration BIGINT DEFAULT 0 NOT NULL, billsec BIGINT DEFAULT 0 NOT NULL, disposition TEXT NOT NULL, amaflags BIGINT DEFAULT 0 NOT NULL, accountcode TEXT NOT NULL, uniqueid TEXT NOT NULL, userfield TEXT NOT NULL, billed BOOLEAN DEFAULT 'false' NOT NULL, PRIMARY KEY(id));
CREATE TABLE asterisk_extensions (id INT, context TEXT NOT NULL, exten TEXT NOT NULL, priority SMALLINT DEFAULT 0 NOT NULL, app TEXT NOT NULL, appdata TEXT, PRIMARY KEY(id));
CREATE TABLE asterisk_sip (id INT, name TEXT NOT NULL, accountcode TEXT, callerid TEXT, canreinvite TEXT DEFAULT 'yes', context TEXT NOT NULL, host TEXT NOT NULL, port INT, mailbox TEXT, md5secret TEXT, nat TEXT DEFAULT 'no' NOT NULL, permit TEXT, deny TEXT, mask TEXT, qualify TEXT, secret TEXT, type TEXT DEFAULT 'friend' NOT NULL, username TEXT NOT NULL, defaultuser TEXT, useragent TEXT, fromuser TEXT DEFAULT 'NULL', fromdomain TEXT DEFAULT 'NULL', disallow TEXT DEFAULT 'all', allow TEXT DEFAULT 'ulaw;alaw', ipaddr TEXT, mac TEXT, fullcontact TEXT DEFAULT NULL, regexten TEXT DEFAULT NULL, regserver TEXT DEFAULT NULL, regseconds BIGINT DEFAULT 0, lastms BIGINT DEFAULT 0, PRIMARY KEY(id));
CREATE TABLE asterisk_voicemail (id INT NOT NULL, customer_id BIGINT DEFAULT 0 NOT NULL, context TEXT NOT NULL, mailbox BIGINT DEFAULT 0 NOT NULL, password TEXT DEFAULT '0' NOT NULL, fullname TEXT NOT NULL, email TEXT NOT NULL, pager TEXT NOT NULL, stamp TIMESTAMP NOT NULL);
CREATE TABLE banks (bank_number TEXT UNIQUE, name TEXT NOT NULL, zip CHAR(255), locality TEXT, PRIMARY KEY(bank_number));
CREATE TABLE bills (id BIGINT, resident BIGINT NOT NULL, date DATE NOT NULL, amount NUMERIC(18,2) NOT NULL, debit_failed BOOLEAN DEFAULT 'false' NOT NULL, PRIMARY KEY(id));
CREATE TABLE calls (id BIGINT, resident BIGINT NOT NULL, extension SMALLINT NOT NULL, date TIMESTAMP DEFAULT 'now()', duration BIGINT NOT NULL, destination TEXT NOT NULL, charges NUMERIC(18,2) NOT NULL, rate BIGINT NOT NULL, bill BIGINT DEFAULT 0, PRIMARY KEY(id));
CREATE TABLE comments (id BIGSERIAL, resident BIGINT NOT NULL, stamp TIMESTAMP DEFAULT 'now()' NOT NULL, comment TEXT NOT NULL, PRIMARY KEY(id));
CREATE TABLE phones (id BIGINT, name TEXT NOT NULL UNIQUE, accountcode TEXT, callerid TEXT, canreinvite TEXT DEFAULT 'yes', host TEXT NOT NULL, port BIGINT, mailbox TEXT, md5secret TEXT, nat TEXT DEFAULT 'no' NOT NULL, permit TEXT, deny TEXT, mask TEXT, qualify TEXT, secret TEXT, type TEXT DEFAULT 'friend' NOT NULL, username TEXT NOT NULL, defaultuser TEXT, useragent TEXT, fromuser TEXT DEFAULT NULL, fromdomain TEXT DEFAULT NULL, disallow TEXT DEFAULT 'all', allow TEXT DEFAULT 'ulaw;alaw', ipaddr TEXT, mac TEXT UNIQUE, fullcontact TEXT DEFAULT NULL, regexten TEXT DEFAULT NULL, regserver TEXT DEFAULT NULL, regseconds BIGINT DEFAULT 0, lastms BIGINT DEFAULT 0, PRIMARY KEY(id));
CREATE TABLE prefixes (id BIGINT, prefix TEXT NOT NULL, name TEXT NOT NULL, region BIGINT NOT NULL, PRIMARY KEY(id));
CREATE TABLE providers (id BIGINT, name TEXT NOT NULL, PRIMARY KEY(id));
CREATE TABLE rates (id BIGINT, provider BIGINT NOT NULL, primary_time_begin TIME NOT NULL, primary_time_rate NUMERIC(18,2) NOT NULL, secondary_time_begin TIME, secondary_time_rate NUMERIC(18,2), weekend BOOLEAN DEFAULT 'true' NOT NULL, week BOOLEAN DEFAULT 'true' NOT NULL, pulsing VARCHAR(255) NOT NULL, name TEXT NOT NULL, PRIMARY KEY(id));
CREATE TABLE rates_regions (id BIGINT, rate BIGINT NOT NULL, region BIGINT, PRIMARY KEY(id));
CREATE TABLE regions (id BIGINT, name TEXT NOT NULL UNIQUE, PRIMARY KEY(id));
CREATE TABLE residents (id BIGINT, last_name TEXT NOT NULL, first_name TEXT NOT NULL, email TEXT UNIQUE, move_in DATE NOT NULL, move_out DATE, bill_limit BIGINT DEFAULT 75 NOT NULL, room BIGINT, warning1 BOOLEAN DEFAULT 'false', warning2 BOOLEAN DEFAULT 'false', unlocked BOOLEAN DEFAULT 'false', shortened_itemized_bill BOOLEAN DEFAULT 'true', account_number TEXT, bank_number TEXT, password TEXT, PRIMARY KEY(id));
CREATE TABLE rooms (id BIGINT, room_no BIGINT, comment TEXT, phone BIGINT, PRIMARY KEY(id));
CREATE TABLE sf_guard_forgot_password (id BIGSERIAL, user_id BIGINT NOT NULL, unique_key VARCHAR(255), expires_at TIMESTAMP NOT NULL, created_at TIMESTAMP NOT NULL, updated_at TIMESTAMP NOT NULL, PRIMARY KEY(id));
CREATE TABLE sf_guard_group (id BIGSERIAL, name VARCHAR(255) UNIQUE, description VARCHAR(1000), created_at TIMESTAMP NOT NULL, updated_at TIMESTAMP NOT NULL, PRIMARY KEY(id));
CREATE TABLE sf_guard_group_permission (group_id BIGINT, permission_id BIGINT, created_at TIMESTAMP NOT NULL, updated_at TIMESTAMP NOT NULL, PRIMARY KEY(group_id, permission_id));
CREATE TABLE sf_guard_permission (id BIGSERIAL, name VARCHAR(255) UNIQUE, description VARCHAR(1000), created_at TIMESTAMP NOT NULL, updated_at TIMESTAMP NOT NULL, PRIMARY KEY(id));
CREATE TABLE sf_guard_remember_key (id BIGSERIAL, user_id BIGINT, remember_key VARCHAR(32), ip_address VARCHAR(50), created_at TIMESTAMP NOT NULL, updated_at TIMESTAMP NOT NULL, PRIMARY KEY(id));
CREATE TABLE sf_guard_user (id BIGSERIAL, first_name VARCHAR(255), last_name VARCHAR(255), email_address VARCHAR(255) NOT NULL UNIQUE, username VARCHAR(128) NOT NULL UNIQUE, algorithm VARCHAR(128) DEFAULT 'sha1' NOT NULL, salt VARCHAR(128), password VARCHAR(128), is_active BOOLEAN DEFAULT 'true', is_super_admin BOOLEAN DEFAULT 'false', last_login TIMESTAMP, created_at TIMESTAMP NOT NULL, updated_at TIMESTAMP NOT NULL, PRIMARY KEY(id));
CREATE TABLE sf_guard_user_group (user_id BIGINT, group_id BIGINT, created_at TIMESTAMP NOT NULL, updated_at TIMESTAMP NOT NULL, PRIMARY KEY(user_id, group_id));
CREATE TABLE sf_guard_user_permission (user_id BIGINT, permission_id BIGINT, created_at TIMESTAMP NOT NULL, updated_at TIMESTAMP NOT NULL, PRIMARY KEY(user_id, permission_id));
CREATE SEQUENCE asterisk_extensions_id_seq INCREMENT 1 START 1;
CREATE SEQUENCE asterisk_sip_id_seq INCREMENT 1 START 1;
CREATE SEQUENCE bills_id_seq INCREMENT 1 START 1;
CREATE SEQUENCE calls_id_seq INCREMENT 1 START 1;
CREATE SEQUENCE phone_id_seq INCREMENT 1 START 1;
CREATE SEQUENCE prefixes_id_seq INCREMENT 1 START 1;
CREATE SEQUENCE rates_regions_id_seq INCREMENT 1 START 1;
CREATE SEQUENCE room_id_seq INCREMENT 1 START 1;
CREATE INDEX is_active_idx ON sf_guard_user (is_active);
ALTER TABLE bills ADD CONSTRAINT bills_resident_residents_id FOREIGN KEY (resident) REFERENCES residents(id) NOT DEFERRABLE INITIALLY IMMEDIATE;
ALTER TABLE calls ADD CONSTRAINT calls_resident_residents_id FOREIGN KEY (resident) REFERENCES residents(id) NOT DEFERRABLE INITIALLY IMMEDIATE;
ALTER TABLE comments ADD CONSTRAINT comments_resident_residents_id FOREIGN KEY (resident) REFERENCES residents(id) NOT DEFERRABLE INITIALLY IMMEDIATE;
ALTER TABLE prefixes ADD CONSTRAINT prefixes_region_regions_id FOREIGN KEY (region) REFERENCES regions(id) NOT DEFERRABLE INITIALLY IMMEDIATE;
ALTER TABLE rates ADD CONSTRAINT rates_provider_providers_id FOREIGN KEY (provider) REFERENCES providers(id) NOT DEFERRABLE INITIALLY IMMEDIATE;
ALTER TABLE rates_regions ADD CONSTRAINT rates_regions_region_regions_id FOREIGN KEY (region) REFERENCES regions(id) NOT DEFERRABLE INITIALLY IMMEDIATE;
ALTER TABLE rates_regions ADD CONSTRAINT rates_regions_rate_rates_id FOREIGN KEY (rate) REFERENCES rates(id) NOT DEFERRABLE INITIALLY IMMEDIATE;
ALTER TABLE residents ADD CONSTRAINT residents_room_rooms_id FOREIGN KEY (room) REFERENCES rooms(id) NOT DEFERRABLE INITIALLY IMMEDIATE;
ALTER TABLE residents ADD CONSTRAINT residents_bank_number_banks_bank_number FOREIGN KEY (bank_number) REFERENCES banks(bank_number) NOT DEFERRABLE INITIALLY IMMEDIATE;
ALTER TABLE rooms ADD CONSTRAINT rooms_phone_phones_id FOREIGN KEY (phone) REFERENCES phones(id) NOT DEFERRABLE INITIALLY IMMEDIATE;
ALTER TABLE sf_guard_forgot_password ADD CONSTRAINT sf_guard_forgot_password_user_id_sf_guard_user_id FOREIGN KEY (user_id) REFERENCES sf_guard_user(id) ON DELETE CASCADE NOT DEFERRABLE INITIALLY IMMEDIATE;
ALTER TABLE sf_guard_group_permission ADD CONSTRAINT sf_guard_group_permission_permission_id_sf_guard_permission_id FOREIGN KEY (permission_id) REFERENCES sf_guard_permission(id) ON DELETE CASCADE NOT DEFERRABLE INITIALLY IMMEDIATE;
ALTER TABLE sf_guard_group_permission ADD CONSTRAINT sf_guard_group_permission_group_id_sf_guard_group_id FOREIGN KEY (group_id) REFERENCES sf_guard_group(id) ON DELETE CASCADE NOT DEFERRABLE INITIALLY IMMEDIATE;
ALTER TABLE sf_guard_remember_key ADD CONSTRAINT sf_guard_remember_key_user_id_sf_guard_user_id FOREIGN KEY (user_id) REFERENCES sf_guard_user(id) ON DELETE CASCADE NOT DEFERRABLE INITIALLY IMMEDIATE;
ALTER TABLE sf_guard_user_group ADD CONSTRAINT sf_guard_user_group_user_id_sf_guard_user_id FOREIGN KEY (user_id) REFERENCES sf_guard_user(id) ON DELETE CASCADE NOT DEFERRABLE INITIALLY IMMEDIATE;
ALTER TABLE sf_guard_user_group ADD CONSTRAINT sf_guard_user_group_group_id_sf_guard_group_id FOREIGN KEY (group_id) REFERENCES sf_guard_group(id) ON DELETE CASCADE NOT DEFERRABLE INITIALLY IMMEDIATE;
ALTER TABLE sf_guard_user_permission ADD CONSTRAINT sf_guard_user_permission_user_id_sf_guard_user_id FOREIGN KEY (user_id) REFERENCES sf_guard_user(id) ON DELETE CASCADE NOT DEFERRABLE INITIALLY IMMEDIATE;
ALTER TABLE sf_guard_user_permission ADD CONSTRAINT sf_guard_user_permission_permission_id_sf_guard_permission_id FOREIGN KEY (permission_id) REFERENCES sf_guard_permission(id) ON DELETE CASCADE NOT DEFERRABLE INITIALLY IMMEDIATE;
